# Dummy Translation Service - DTS

This project is intended to be used as a PoC for Observability principles. If you want to read more about 
the concept of observability in distributed systems see the [References] section below.

## DTS - High Level Architecture

The system is composed of 5 services devoted to wonderful task of translating completely useless and irrelevant English sentences.

![DTS Architecture](/images/DTS-Arch.png)

## How to run the project using docker-compose

Install [Docker](https://www.docker.com/) v19.0+ in your machine and simply run 

    docker-compose up -d
    
Make sure you have enough resources, otherwise services like 'elastic' or 'kafka' might not be able to start
    
![Docker minimun resources](/images/DockerMinResources.png)
     
## How to recreate the docker images for each of the services   

If you have modified the code and want to recreate the images for a particular service, simply run the following command:

    DOCKER_BUILDKIT=1 docker build -f $SERVICE-Dockerfile -t dts/$service .
   
Where you need to fill the right details for each service. For example, to rebuild the image of the english service use:

    DOCKER_BUILDKIT=1 docker build -f English-Dockerfile -t dts/english .

You can also use the convenience ``buildAll.sh`` script to rebuild all the images


## How to run the project in Kubernetes

Refer to the [k8s section](k8s/README.md)

## Using the Dummy Translator Service

Once the system is up and all its services are up and running you can trigger the translation process by sending a GET request to 
the English initiator service. For example:

    http://localhost:8091/start?batch=10 
   
Will trigger the service to send batches of 10 messages (in English) to the __english__ kafka topic every second

You can also stop the publishing using an equivalent GET request:

    http://localhost:8091/stop    
    
## Observing the system

Once the DTS system is up and running you can use the list of URLs below to connect to each of the services providing insights about how the system is behaving:

### Logs
Kibana: http://localhost:5601/

### Metrics
You can see the metrics provided by each service just by querying the Actuator endpoint for Prometheus on each of the service. For example,
if you to see the metrics for the Spanish Translation service, you can hit:

http://localhost:8082/actuator/prometheus

![Actuator Prometheus](/images/Actuator.png)

If you want to get a centralized access to all the metrics generated by the system, you can visit Prometheus dashboard:

Prometheus UI: http://localhost:9090/

![Prometheus UI](/images/Prometheus.png)

However, as we have integrated Prometheus with **Grafana**, the best visualization experience will be obtained by visiting:

Grafana: http://localhost:3000/

Foer example, go to the dashboards section in Grafana:

![Grafana Dashboards](/images/GrafanaDashboards.png)

And open the **Translation Metrics** to see the metrics related to the functional aspects of the system:

![DTS Metrics](/images/TranslationMetricsDashboard.png)

Whereas for non-functional metrics, related to aspects like memory consumption, CPU, disk, etc.. you can see examples in the **JVM Metrics** Dashboard:

![JVM specifics metrics](/images/JVMMetricsDashboard.png)

### Distributing tracing
Zipkin UI: http://localhost:9411/

![Zipkin Flow](/images/ZipkinFlow.png)

The ports for each of these services can be modified in the ``docker-compose.yml`` file

Also, you can optionally start up Kafka console consumers as well in case you want to see the flow of messages coming in each Kafka topic.
This can be done in two ways depending on whether you have a local installation of Kafka or prefer to use the dockerized version:

1. Local Kafka
    
    
    ${KAFKA_HOME}/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic $TOPIC

For example, to consume messages from the Spanish topic:

    ${KAFKA_HOME}/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic spanish    

2. From the dockerized Kafka
    
    
    docker run -it --rm --network="observability-poc_observability" --link observability-poc_kafka_1 bitnami/kafka:2 /opt/bitnami/kafka/bin/kafka-console-consumer.sh --bootstrap-server kafka:29092 --topic spanish    
    
## References


* [The three pillars of Observability](https://www.oreilly.com/library/view/distributed-systems-observability/9781492033431/ch04.html)
  Distributed Systems Observability by Cindy Sridharan, O'Reilly
  
### Events logs
* [Elastic Stack](https://www.elastic.co/elastic-stack)


### Metrics
* [Prometheus IO](https://prometheus.io/) 

* [Micrometer.io](https://micrometer.io/docs)


### Distributed Tracing
* [The Open Tracing project](https://opentracing.io/)

* [Zipkin IO](https://zipkin.io/)

* [Spring Cloud Sleuth](https://spring.io/projects/spring-cloud-sleuth)
